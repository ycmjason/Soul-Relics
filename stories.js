var stories = [
	{
		id: 0,
		title: 'A Remote Control',
		name: '',
		image:'./remotecontrol.png',
		filter: [],
		story: 'Because I used to steal them when I had OCD to save the people from mind poison and keep the trajectories of their life force. I don’t do it (much) anymore – but I own over 267 remote controls – sorry!'
	},
	{
		id: 1,
		title: '138',
		name: 'Sarah',
		image: './flower.png',
		filter: ['stress'],
		story: 'I had left my job due to severe stress and did not have a job to go to. I was very low and lacking in self-confidence. I started to make myself go for little local walks from my home in the middle of the city. In places where there were lots of people I felt lost, they all seemed full of purpose and direction compared to me. I didn\'t belong. Then I started to notice small pockets of nature that were managing to thrive in harsh conditions. Noticing and then photographing this nature in the urban environment gave me a focus and, looking back, I suppose was a kind of metaphor for hope in bleak surroundings. It was a kind of mindfulness that enabled me to connect again. This photograph is one of those I took during this time of a beautiful lilac blossom growing in a parking bay on the estate where I live. '
	},
	{
		id: 2,
		title: 'Clothes Drier',
		name: '',
		image: '',
		filter: [],
		story: 'I would put in my clothes drier (clothers rack). It symbolises my escape from an abusive relationship and my new start in discouraging myself'
	},
	{
		id: 3,
		title: '',
		name: 'Sarah',
		image: '',
		filter: [],
		story: 'A shard of glass, from the bathroom window I smashed when I was 20. The object says more than I can put into words, because I could never really explain satisfactorily to anyone else why I did it. I felt constantly trapped at the time. I was sure my skull was contracting, slowly crushing my brain, and I needed to do something drastic to break free. I often thought about smashing windows. I’ve always been quite attached to buildings, and it seemed quite natural to regard a window as an extension of myself. So one day I put my fist through one. It was a double-glazed pane, and I still remember the ‘boom’ when the inner glass broke as the sound of freedom. My flatmates, who had to clean up the mess while I trod all over the broken glass in bare feet, were of an entirely different opinion.'
	},
	{
		id: 4,
		title: 'Filippa',
		name: 'Kate',
		image: 'filippa.jpg',
		filter: ['anxiety', 'depression'],
		story: 'Whenever I have a breakdown and I\'m on the verge of despair and don\'t feel like talking to anyone I want to retreat in bed into my own world and just cry in my pillow and squeeze my strawberry Filippa. The idea of calling someone seems pointless or stressful on those moments, so in that sense Filippa has "seen" more sides and states of me than some of the closest people. Just hugging a soft and happy-looking is sometimes enough for me to come back to more manageable feelings.'
	},
	{
		id: 5,
		title: '',
		name: '',
		image: '',
		filter: [],
		story: 'A used toothbrush on a bathroom shelf. Inside a toothbrush holder next to the toothpaste as it always is. The only thing is that this toothbrush should not be there. It should be in someone\’s bag while travelling for work.When I saw it, at 10:15 pm that night the world ended and a new one started. You see, this is how the clueless me found out that my partner of 16 years was having an affair with (a most boring) friend. He chose her. They were together for a year by then. I died. The following months after were the most difficult and painful. The first month of being on my own and all that this meant I had all the physical symptoms of the broken heart. I thought seriously constantly of how I might die of how people do die of this. Friends were fabulous and picked me up. Then a beautiful man took my hand and led me out of the darkness, less than a month later, the 100 years later. One day at a time, one minute at a time, one second that the pain isn’t there anymore. Now I am someone who’s more beautiful.'
	},
	{
		id: 6,
		title:'Crutches',
		name: '',
		image:'',
		filter:[],
		story:'My crutches - recovery but also now permanent. They keep me mobile but have caused other problems for my body (arthritis etc). They are a mixed blessing but they are a visible symbol of how I manage my invisible condition. They represent my normal.'
	},
	{
		id: 7,
		title: 'Plato\'s Republic',
		name:'Davidinio',
		image:'plato.jpg',
		filter:[],
		story:'In essence, I always followed the status quo, lived by the motions, and did what every good studious medical student/youthful party goer should - study medicine, go out and get drunk, and repeat. I never had any ambition or imagination, because there was no impetus to - the path for my life was largely carved out, and there was no need for me to do anything really, as I was rather content and didn\'t see the point of wasting time and energy. But then I went through a very tough few months of exams, where I experienced strong feelings of anxiety, guilt, self-loathing, and the lot, and it escalated into a full state of depression mixed with anxiety. I lacked self-awareness and mental health awareness to truly understand what was going on and to be able to see the root causes of my poor state of mind. I was also thrown into a state of existentialism - repeatedly thinking \'I hate this shit. Why on Earth am I doing it? Who decided my fate? Why can I not do something else? Is this really the best my life can be?\' I felt that such analysis was vacuous and out of place, and that I would be absconded by anyone were I to voice my nihilistic utterings, especially given my good situation and blessings in life. I simply did not have a tool, or the comprehension, to commence vivaciously re-analysing my life and re-structuring it for the better. A lack of understanding and self-awareness led to an apathy of action. If I had truly known that what I experienced was outside the realms of tolerability perhaps I would have been poised to act differently. But I didn’t.  There was no attempt at any level to bulwark myself against the return of this chaotic phenomenon. Of course, it transpired again, and again, and again. Year on year while at university, the episodes would be darker and unbearably longer, each one worse than the last. I would only blame myself for feeling so poorly, believing that my sadness was the inevitable consequence of my many failures and imperfections, each of which I simply had to work on harder. It was an ecosystem of destructiveness permeating through my everyday life: I would be incapable of simple work or simple social interactions, and this reliably made me feel like more of a failure and an alien – and so it went on. Though I picked up knowledge about mental health from the course, it was very hard to conjoin my subjective experience with the objective understanding of medical sciences, and to truly believe that perhaps my mind may be defective in some way. Indeed, this was the hardest part of the entire ordeal, and why it took so long and required for things to get so bad. Being honest with yourself and saying that you may have a mental health problem can be very difficult, especially if you come from a background of hushed whispers and destructive taboos surrounding mentality, a robust illusion of complete autonomy over your thoughts and mood, and little exposure to genuine understanding of the mind. These experiences were reduced to a simple interpretation of life – that the universe was unpleasant and interspersed with painful things, and amidst its evils there seems to be only the bitter reality of confusion and dejection; while the conscious experience is stable, pre-determined, and hollow. I felt like I was destined to spend most of my future life feeling rather unhappy. I would cry out to question and penetrate the bleak walls of such realities, but my pleas would not be answered. My mind would respond defensively, asserting that I ought to persist with what I had been taught, and leave the ostensible emptiness of my requests behind me.  If getting to the crux of the questions did not seem to be in the realms of possibility; changing the answers that they enshrined was a fantasy tale. The solutions are simple - find that brave face, smile, and push on. Life cannot be changed. You cannot be changed. There was a glimmer of disgruntlement at such a tenuous conclusion. It was to become my saviour. I began realising that there were scattered happy moments that fleeted by. Rather, there were moments free of pain, where I had slither of equanimity and true joy. Yet, I did not understand how these feelings came about – nor did I have any stimulus to. Since no one talked about the landscape of subjective states, of what constitutes the good life, of the roots of happiness, I did not stumble across these ideas readily. Besides, there were so many significant and imperative objectives to focus on – becoming a doctor, becoming successful, being a good person – who has time for this self-indulgent pursuit of centring one’s attention on personal happiness when there is so much to be thinking about? Yet, some part of me could not be satisfied with this answer. I yearned I and searched for meaning to existence, something to cling on to, an answer, a hope. The vacuous questions regarding the objective constitutions of happiness and meaning for which I searched for yielded the same vacuous answers of complicated empty words stringed together in sentences by highbrow academics that voiced anything but candid depictions of life. But one day, through a series of coincidences, I picked up my first ever intellectual and philosophical book - The Republic. The beauty of the analytical, honest and in depth scrutiny of Socrates demonstrated to me the limitless potential to create and shape our vlaues, to sculpt our lives, and to live fervently with the truth. It demonstrated that the status quo, and what all of my friends and family were doing, were not necessarily correct. This catalysed two things: one, a love of knowledge, reading and understanding of the world, which to this day adds incredible joy and stimulation to my days and embellishes my projects, and indeed my life, in a meaningful and fun context. The other, a confidence in my self, and a relentless pursuit of what is true and what is good. This has prevented relapses into depressive states, as I know myself better and am more aware of my mental landscape, nurturing it gently, and directing my awareness to things that deserve it. It has also made a more moral, more unique, and more connected person. Credit to Socrates!'
	},
	{
		id: 8,
		title: 'Pebble',
		name:'Steph',
		image:'pebble.jpg',
		filter:[],
		story:'During my first two years as an undergraduate law student, I often sat down by a field that was in the centre of the campus, watching the sun fall on the grass and on the pebbles that bordered the field. The days were hot, muggy and often hazy, an atmosphere which seemed to be reflected in the inside of my mind. Coming into my early twenties and put into a state of unrest by the changes in my life, I was feeling mind crack under mounting internal tension and anxiety. I spent hours hammering the same questions in my head, wondering who I was, what I should feel and where I should situate my sense of meaning. I tried to avoid reading and writing, feeling like the words would suffocate me. If I put pen to paper I could never be satisfied. I wrote and cancelled and re-wrote, the end product being a mess of scratch marks and scribbles which did not in any way resemble what I wanted to project. I got lost and then got lost about being lost and was often a mess. One day a friend of mine picked this very round pebble from the pile. “Useless as a paperweight,” he said. “But that doesn’t make it of any less worth as a stone”. I carried it around in my bag for the next few months. The feel of it, small but solid and certain in my palm, gave me comfort. Small gifts like these made me feel like little parts of myself were being restored to me, and helped me on the way towards finding the sense of assurance, composure and hopefulness I needed to move forward.'
	},
	{
		id: 9,
		title:'Blank',
		name:'',
		image:'./aboutblank.png',
		filter:[],
		story:'The title bar from the internet when I was googling memories to commit suicide'
	}
];

var hider = document.querySelector('.hider');
hider.style.display = 'none';
hider.addEventListener('click', function() {
	arrangeStories(0);
	waterfall.className = 'standard';
	this.style.display = 'none';
});

function trimToEllipsis(text) {
	// Trims text and adds ellipsis to prevent ugly overflowing text
	var waterfall = document.querySelector('#waterfall');
	var numCharacters = Math.floor(Math.random() * 100 + 100);
	if(text.length > numCharacters && waterfall.className !== 'magnify')
		return text.slice(0, numCharacters) + '...';
	else
		return text;
}

function makeElement(tag, props, style) {
	var elem = document.createElement(tag);
	for(var key in props) { elem[key] = props[key]; }
	for(var key in style) { elem.style[key] = style[key]; }
	return elem;
}

function createStory(story) {
	// Maps a story object to a template
	var storyContainer = makeElement('li');
	var storyEl = makeElement('div', {className: 'story'});
	var storyImageEl = makeElement('img', {
		className: 'story-image',
		src: story.image || 'http://www.codeodor.com/images/Empty_set.png'
	});
	var storyTitleEl = makeElement('h3', {
		className: 'story-title cursive-type',
		textContent: story.title || 'Untitled'
	});
	var storyAuthorEl = makeElement('h4', {
		className: 'story-author sans-type',
		textContent: story.name || 'Anonymous'
	});
	var storyContentEl = makeElement('p', {
		className: 'story-content sans-type',
		textContent: trimToEllipsis(story.story)
	});

	// Join the elements into a template for a story
	storyEl.addEventListener('click', function(event) {
		$('html,body').scrollTop(0);
		var waterfall = document.querySelector('#waterfall');
		waterfall.className = 'magnify';
		hider.style.display = 'block';
		arrangeStories(story.id);
	});

	var shareButton = makeElement('i', {
		className: 'material-icons',
		textContent: 'share'
	});

	storyEl.append(storyImageEl);
	storyEl.append(storyTitleEl);
	storyEl.append(storyAuthorEl);
	storyEl.append(storyContentEl);
	storyEl.append(shareButton);
	storyContainer.append(storyEl);
	return storyContainer;
}

// Map each story to a template
function arrangeStories(firstId) {
	var storiesCopy = stories.slice();
	if(firstId) {
		var firstStoryIndex = storiesCopy.findIndex(function(story) {
			return firstId === story.id;
		});
		storiesCopy.unshift(storiesCopy.splice(firstStoryIndex, 1)[0]);
	}
	var storyTemplates = storiesCopy.map(function(story) {
		return createStory(story);
	});
	// Attach templates to the DOM
	var waterfall = document.querySelector('#waterfall');
	while(waterfall.hasChildNodes()) {
		waterfall.removeChild(waterfall.lastChild);
	}
	storyTemplates.forEach(function(template) {
		waterfall.append(template);
	});
}

var waterfall = document.querySelector('#waterfall');
waterfall.className = 'standard';

arrangeStories();

